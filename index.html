<!DOCTYPE html>
<html>

  <head>
    <title>Streetex</title>
    <script src="https://unpkg.com/maplibre-gl@^5.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@^5.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css">

  </head>

  <body>
<div id="map"></div>
<script>
  var map = new maplibregl.Map({
    container: 'map',
    style: 'https://api.protomaps.com/styles/v5/light/en.json?key=50ad6769afe3dbd6',
    center: [21, 0],
    zoom: 17,
    pitch: 60,
    bearing: 0,
    antialias: true
  });

  map.addControl(new maplibregl.NavigationControl());

  const userMarker = new maplibregl.Marker({ color: 'red' });

  let currentHeading = 0;

  // Try to get heading from device
  if (window.DeviceOrientationEvent) {
    window.addEventListener('deviceorientationabsolute', (event) => {
      if (event.absolute && event.alpha !== null) {
        currentHeading = 360 - event.alpha; // convert to compass-style
      }
    }, true);
  }

  if ('geolocation' in navigator) {
    navigator.geolocation.watchPosition(
      (position) => {
        const { latitude, longitude } = position.coords;
        const userLocation = [longitude, latitude];

        // Update user marker
        userMarker.setLngLat(userLocation).addTo(map);

        // Smoothly move map like PokÃ©mon GO
        map.easeTo({
          center: userLocation,
          bearing: currentHeading,
          pitch: 60,
          zoom: 17,
          duration: 1000,
          offset: [0, window.innerHeight / 4 * -1],
          easing: t => t
        });
      },
      (error) => {
        console.error('Error watching position:', error.message);
      },
      {
        enableHighAccuracy: true,
        maximumAge: 1000,
        timeout: 5000
      }
    );
  } else {
    alert('Geolocation not supported by your browser.');
  }
</script>
</body>