<!DOCTYPE html>
 <html>
 
   <head>
     <title>Streetex</title>
     <script src="https://unpkg.com/maplibre-gl@^5.4.0/dist/maplibre-gl.js"></script>
     <link href="https://unpkg.com/maplibre-gl@^5.4.0/dist/maplibre-gl.css" rel="stylesheet" />
     <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>
     
     <link rel="stylesheet" href="styles.css">
</head>
 
<body>
<div id="map"></div>
<script>
    let map = new maplibregl.Map({
        container: 'map', // container id
        style: 'style.json', // style URL
        center: [10.482593, 59.416571], // starting position [lng, lat]
        zoom: 16, // starting zoom
        pitch: 70,
        maxPitch: 80,
        bearing: 0,
        antialias: true

    });

map.on('load', () => {
    const layers = map.getStyle().layers;
    layers.forEach(layer => {
        console.log(layer.id, layer.type); // Check the layer ID and type
    });
  const customLayer = {
    id: 'threejs-layer',
    type: 'custom',
    renderingMode: '3d',
    onAdd(map, gl) {
      // Init THREE scene
      this.camera = new THREE.Camera();
      this.scene = new THREE.Scene();

      this.renderer = new THREE.WebGLRenderer({
        canvas: map.getCanvas(),
        context: gl,
        antialias: true
      });
      this.renderer.autoClear = false;

      // Add a 3D model or character (e.g. a cube as placeholder)
      const geometry = new THREE.BoxGeometry(10, 10, 10);
      const material = new THREE.MeshNormalMaterial();
      this.mesh = new THREE.Mesh(geometry, material);
      this.scene.add(this.mesh);

      // Example: Set initial position in Mercator coordinates
      const merc = maplibregl.MercatorCoordinate.fromLngLat(
        [10.482593, 59.416571], 0
      );
      this.mesh.position.set(merc.x, merc.y, merc.z);
    },

    render(gl, matrix) {
      // Convert MapLibre matrix to Three.js projection
      const m = new THREE.Matrix4().fromArray(matrix);
      this.camera.projectionMatrix = m;
      this.renderer.state.reset();
      this.renderer.render(this.scene, this.camera);
      map.triggerRepaint();
    }
  };

  map.addLayer(customLayer);
});




</script>

</body>